<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Gikomba ‚Äî Authentic Thrift From Verified Sellers</title>
    <meta name="description" content="Quality handpicked thrift wear from KES 50. One-piece only items. Chat directly with verified Gikomba sellers via WhatsApp.">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://gikomba.shop/">
    
    <!-- Open Graph Meta -->
    <meta property="og:title" content="Online Gikomba ‚Äî Authentic Thrift From Verified Sellers">
    <meta property="og:description" content="Browse handpicked Gikomba thrift from verified sellers. Chat on WhatsApp before you pay. New items daily.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://gikomba.shop/preview.jpg">
    <meta property="og:url" content="https://gikomba.shop/">
    
    <!-- Twitter Card Meta -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Online Gikomba ‚Äî Authentic Thrift From Verified Sellers">
    <meta name="twitter:description" content="Browse handpicked Gikomba thrift from verified sellers. Chat on WhatsApp before you pay. New items daily.">
    <meta name="twitter:image" content="https://gikomba.shop/preview.jpg">
    
    <!-- Preconnect hints -->
    <link rel="preconnect" href="https://wa.me">
    <link rel="preconnect" href="https://firestore.googleapis.com">
    <link rel="dns-prefetch" href="https://wa.me">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üá∞üá™</text></svg>">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-storage-compat.js"></script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "Online Gikomba",
        "url": "https://gikomba.shop/",
        "description": "Nairobi's trusted thrift marketplace. Verified sellers, authentic items, buyer-seller direct connection.",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://gikomba.shop/?search={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #0a0a0a;
            --accent: #d4af37;
            --accent-dark: #b8941f;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --info: #3498db;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-600: #6c757d;
            --gray-800: #343a40;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-gold: 0 4px 20px rgba(212, 175, 55, 0.3);
        }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: var(--primary); background: var(--white); }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        
        /* Skip Link for Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent);
            color: var(--primary);
            padding: 8px 16px;
            z-index: 10000;
            text-decoration: none;
            font-weight: 700;
            border-radius: 0 0 8px 0;
        }
        .skip-link:focus {
            top: 0;
        }
        
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: var(--primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.warning { border-left: 4px solid var(--warning); }
        .toast.info { border-left: 4px solid var(--info); }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Role Disclaimer */
        .role-disclaimer { background: #fff8e1; padding: 0.75rem; text-align: center; font-size: 0.8rem; color: #6c757d; border-bottom: 1px solid #ffe082; }
        
        /* Trust Bar */
        .trust-bar { background: var(--success); color: white; padding: 0.5rem; text-align: center; font-size: 0.85rem; font-weight: 600; }
        
        /* Navbar */
        .navbar { position: sticky; top: 0; background: var(--primary); border-bottom: 2px solid var(--accent); z-index: 1000; padding: 1rem 0; }
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--white); text-decoration: none; }
        .logo span { color: var(--accent); }
        .nav-links { display: flex; gap: 2rem; list-style: none; align-items: center; }
        .nav-links a { color: var(--gray-200); text-decoration: none; font-weight: 500; transition: color 0.2s; }
        .nav-links a:hover { color: var(--accent); }
        .nav-cta { background: var(--accent); color: var(--primary) !important; padding: 0.5rem 1.25rem; border-radius: 25px; font-weight: 700; }
        .mobile-menu-btn { display: none; background: none; border: none; font-size: 1.5rem; color: var(--white); cursor: pointer; }
        
        .mobile-nav { display: none; background: var(--primary); padding: 1rem; position: fixed; top: 70px; left: 0; right: 0; z-index: 999; border-bottom: 2px solid var(--accent); }
        .mobile-nav.active { display: block; }
        .mobile-nav a { display: block; color: var(--white); text-decoration: none; padding: 1rem 0; border-bottom: 1px solid var(--gray-800); }

        /* Hero */
        .hero { background: linear-gradient(135deg, var(--primary) 0%, #1a1a1a 100%); padding: 4rem 1.5rem; text-align: center; color: var(--white); }
        .hero h1 { font-size: 3rem; font-weight: 800; margin-bottom: 1rem; line-height: 1.2; }
        .hero h1 span { color: var(--accent); }
        .hero-subtitle { font-size: 1.1rem; color: var(--gray-300); max-width: 600px; margin: 0 auto 2rem; }
        .hero-cta { display: inline-block; background: var(--accent); color: var(--primary); padding: 1rem 2.5rem; border-radius: 50px; font-weight: 700; text-decoration: none; font-size: 1.1rem; box-shadow: var(--shadow-gold); transition: transform 0.3s; }
        .hero-cta:hover { transform: translateY(-3px); }

        /* How It Works */
        .how-it-works { background: var(--gray-100); padding: 3rem 1.5rem; }
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; max-width: 1000px; margin: 2rem auto 0; }
        .step { text-align: center; padding: 1.5rem; }
        .step-number { width: 50px; height: 50px; background: var(--accent); color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.25rem; margin: 0 auto 1rem; }

        /* Search and Filter Section */
        .search-filter-section {
            background: var(--gray-100);
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        .search-filter-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }
        .search-box {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--gray-300);
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .search-box::before {
            content: 'üîç';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
        }
        .price-range-filter {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .price-range-filter label {
            font-weight: 600;
            color: var(--gray-600);
        }
        .price-range-filter input {
            width: 100px;
            padding: 0.5rem;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 0.9rem;
        }
        .price-range-filter input:focus {
            outline: none;
            border-color: var(--accent);
        }
        .sort-select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: 25px;
            background: white;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .sort-select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .clear-filters-btn {
            padding: 0.5rem 1rem;
            background: var(--gray-200);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }
        .clear-filters-btn:hover {
            background: var(--gray-300);
        }

        /* Products */
        .products-section { padding: 4rem 1.5rem; background: var(--white); }
        .section-header { text-align: center; margin-bottom: 3rem; }
        .section-header h2 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        
        .filters { display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
        .filter-btn { padding: 0.5rem 1.25rem; border: 2px solid var(--gray-300); background: white; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
        .filter-btn:hover, .filter-btn.active { border-color: var(--accent); background: var(--accent); color: var(--primary); }
        
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto; }
        
        .product-card { background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); border: 1px solid var(--gray-200); transition: all 0.3s; position: relative; }
        .product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        .product-card.reserved { opacity: 0.7; border-color: var(--warning); }
        .product-card.sold { opacity: 0.5; filter: grayscale(100%); }
        
        .product-badges { position: absolute; top: 1rem; left: 1rem; display: flex; flex-direction: column; gap: 0.5rem; z-index: 10; }
        .badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        .badge-hot { background: var(--danger); color: white; }
        .badge-grade { background: var(--success); color: white; }
        .badge-new { background: var(--info); color: white; }
        .badge-verified { background: var(--accent); color: var(--primary); }
        .badge-reserved { background: var(--warning); color: var(--primary); }
        .badge-sold { background: var(--gray-600); color: white; }
        
        .view-counter { position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.7); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; display: flex; align-items: center; gap: 0.25rem; }
        
        .product-image-container { width: 100%; height: 280px; position: relative; overflow: hidden; background: var(--gray-100); }
        .product-image-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .product-card:hover .product-image-container img { transform: scale(1.05); }
        .img-placeholder { width: 100%; height: 100%; background: linear-gradient(45deg, #f1f1f1 25%, #e9ecef 25%, #e9ecef 50%, #f1f1f1 50%, #f1f1f1 75%, #e9ecef 75%, #e9ecef 100%); background-size: 20px 20px; display: flex; align-items: center; justify-content: center; color: var(--gray-600); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; position: relative; }
        .img-placeholder.sold::after { content: 'SOLD'; position: absolute; background: var(--danger); color: white; padding: 0.5rem 2rem; font-size: 1.5rem; font-weight: 800; transform: rotate(-15deg); }
        
        .product-info { padding: 1.5rem; }
        
        .seller-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; flex-wrap: wrap; }
        .seller-name { font-size: 0.85rem; color: var(--gray-600); font-weight: 600; cursor: pointer; }
        .seller-name:hover { color: var(--accent); text-decoration: underline; }
        .seller-badge { font-size: 0.65rem; padding: 0.15rem 0.5rem; border-radius: 10px; background: var(--gray-200); color: var(--gray-600); cursor: help; }
        .seller-badge.verified { background: var(--success); color: white; }
        .seller-stats { font-size: 0.75rem; color: var(--gray-600); margin-left: auto; }
        
        .product-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.3; }
        
        .product-meta { display: flex; gap: 1rem; margin-bottom: 1rem; font-size: 0.8rem; color: var(--gray-600); }
        .condition { display: flex; align-items: center; gap: 0.25rem; }
        .condition-dot { width: 8px; height: 8px; border-radius: 50%; }
        .condition-excellent { background: var(--success); }
        .condition-good { background: var(--warning); }
        .condition-fair { background: var(--danger); }
        
        .price-row { display: flex; align-items: baseline; gap: 0.75rem; margin-bottom: 1rem; }
        .product-price { font-size: 1.5rem; font-weight: 800; color: var(--accent-dark); }
        .original-price { font-size: 1rem; color: var(--gray-600); text-decoration: line-through; }
        .discount { font-size: 0.8rem; color: var(--danger); font-weight: 700; }
        
        .stock-info { font-size: 0.8rem; color: var(--gray-600); margin-bottom: 1rem; display: flex; justify-content: space-between; }
        .time-left { color: var(--danger); font-weight: 600; }
        
        .rating-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem; }
        .stars { color: var(--warning); font-size: 0.9rem; }
        .rating-count { font-size: 0.75rem; color: var(--gray-600); }
        
        .whatsapp-btn { display: flex; align-items: center; justify-content: center; width: 100%; background: #25d366; color: white; padding: 0.875rem; border-radius: 8px; text-decoration: none; font-weight: 700; gap: 0.5rem; transition: all 0.2s; border: none; cursor: pointer; font-size: 1rem; }
        .whatsapp-btn:hover:not(:disabled) { background: #128c7e; transform: translateY(-2px); }
        .whatsapp-btn:disabled { background: var(--gray-600); cursor: not-allowed; }
        .whatsapp-btn.reserved { background: var(--warning); color: var(--primary); }
        
        .notify-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            background: var(--info);
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            gap: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        .notify-btn:hover { background: #2980b9; }
        .notify-btn.subscribed { background: var(--success); }
        
        .protection-notice { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.5rem; background: var(--gray-100); border-radius: 6px; font-size: 0.75rem; color: var(--gray-600); }
        .reservation-clarifier { font-size: 0.75rem; color: var(--gray-600); margin-top: 0.5rem; font-style: italic; }
        
        /* Seller Section */
        .seller-section { background: var(--primary); padding: 5rem 1.5rem; color: white; text-align: center; }
        .seller-benefits { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; max-width: 800px; margin: 2rem auto; text-align: left; }
        .benefit { display: flex; align-items: start; gap: 1rem; }
        .benefit-icon { font-size: 1.5rem; }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-header h3 { font-size: 1.25rem; }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-600);
        }
        .modal-body { padding: 1.5rem; }
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        
        /* Form Styles */
        .form-group { margin-bottom: 1rem; }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-800);
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-300);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        .btn-primary { background: var(--accent); color: var(--primary); }
        .btn-primary:hover { background: var(--accent-dark); }
        .btn-secondary { background: var(--gray-200); color: var(--gray-800); }
        .btn-secondary:hover { background: var(--gray-300); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #27ae60; }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        
        /* Rating Modal */
        .star-rating {
            display: flex;
            gap: 0.5rem;
            font-size: 2rem;
            cursor: pointer;
        }
        .star-rating .star {
            color: var(--gray-300);
            transition: color 0.2s;
        }
        .star-rating .star.active,
        .star-rating .star:hover { color: var(--warning); }
        
        /* Seller Profile Modal */
        .seller-profile-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .seller-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
        }
        .seller-profile-info h4 { font-size: 1.25rem; margin-bottom: 0.25rem; }
        .seller-profile-stats {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 800; color: var(--accent-dark); }
        .stat-label { font-size: 0.75rem; color: var(--gray-600); }
        
        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        .skeleton-card { height: 400px; border-radius: 12px; }
        
        /* Footer */
        .footer { background: var(--primary); color: var(--white); padding: 4rem 1.5rem 1rem; border-top: 1px solid var(--gray-800); }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto 3rem; }
        .footer h3 { color: var(--accent); margin-bottom: 1.5rem; }
        .footer ul { list-style: none; }
        .footer li { margin-bottom: 0.75rem; }
        .footer a { color: var(--gray-300); text-decoration: none; }
        .footer a:hover { color: var(--accent); }
        .footer-disclaimer { border-top: 1px solid var(--gray-800); padding-top: 2rem; margin-top: 2rem; text-align: center; }
        
        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--accent);
            color: var(--primary);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s;
            z-index: 999;
        }
        .back-to-top:hover { transform: translateY(-3px); }
        .back-to-top.visible { display: flex; }
        
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .mobile-menu-btn { display: block; }
            .hero h1 { font-size: 2rem; }
            .products-grid { grid-template-columns: 1fr; }
            .search-filter-container { flex-direction: column; }
            .search-box { max-width: 100%; }
        }
    </style>
<base target="_blank">
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Role Disclaimer -->
    <div class="role-disclaimer">
        Online Gikomba connects buyers with independent sellers. 
        Payments, delivery, and item condition are confirmed directly between buyer and seller.
    </div>

    <div class="trust-bar" role="banner">
        ‚úÖ Buyer Protection: Pay only after confirming item availability. Report issues within 24hrs.
    </div>

    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <a href="#" class="logo" aria-label="Online Gikomba Home">üá∞üá™ Online <span>Gikomba</span></a>
            <ul class="nav-links">
                <li><a href="#shop">Shop</a></li>
                <li><a href="#how-it-works">How It Works</a></li>
                <li><a href="#sell">Become a Seller</a></li>
                <li><a href="https://wa.me/254736906440" class="nav-cta">Contact Support</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMenu()" aria-label="Toggle mobile menu">‚ò∞</button>
        </div>
    </nav>

    <div class="mobile-nav" id="mobileNav" role="navigation" aria-label="Mobile navigation">
        <a href="#shop" onclick="toggleMenu()">Shop</a>
        <a href="#how-it-works" onclick="toggleMenu()">How It Works</a>
        <a href="#sell" onclick="toggleMenu()">Become a Seller</a>
        <a href="https://wa.me/254736906440" onclick="toggleMenu()" style="color: var(--accent);">Contact Support</a>
    </div>

    <section class="hero">
        <div class="container">
            <h1>Authentic Gikomba<br><span>Verified Sellers Only</span></h1>
            <p class="hero-subtitle">
                Direct from the market to your door. Connect with verified sellers, 
                review items before you pay, get delivery support.
            </p>
            <a href="#shop" class="hero-cta">Browse Fresh Arrivals</a>
        </div>
    </section>

    <section class="how-it-works" id="how-it-works">
        <div class="container">
            <div class="section-header">
                <h2>How It Works</h2>
                <p>No accounts needed. Browse, chat, buy.</p>
            </div>
            <div class="steps-grid">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Browse Verified Items</h3>
                    <p>Handpicked thrift from verified Gikomba sellers. Items are reviewed before listing where possible.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Chat on WhatsApp</h3>
                    <p>Click to chat directly with seller. Confirm availability, size, and delivery details.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Pay & Get Delivered</h3>
                    <p>Pay via MPESA after confirming item. Nairobi same-day, countrywide 1-3 days.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="search-filter-section">
        <div class="search-filter-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search products, sellers..." aria-label="Search products">
            </div>
            <div class="price-range-filter">
                <label>Price:</label>
                <input type="number" id="minPrice" placeholder="Min" min="0" aria-label="Minimum price">
                <span>-</span>
                <input type="number" id="maxPrice" placeholder="Max" min="0" aria-label="Maximum price">
            </div>
            <select class="sort-select" id="sortSelect" aria-label="Sort products">
                <option value="newest">Newest First</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="popular">Most Viewed</option>
                <option value="rated">Highest Rated</option>
            </select>
            <button class="clear-filters-btn" onclick="clearFilters()">Clear Filters</button>
        </div>
    </section>

    <main class="products-section" id="shop" role="main">
        <div class="container">
            <div class="section-header">
                <h2>Fresh Arrivals</h2>
                <p>New items added daily. Listings expire after 48 hours.</p>
            </div>
            
            <div class="filters" role="group" aria-label="Category filters">
                <button class="filter-btn active" data-category="all" aria-pressed="true">All Items</button>
                <button class="filter-btn" data-category="men" aria-pressed="false">Men</button>
                <button class="filter-btn" data-category="women" aria-pressed="false">Women</button>
                <button class="filter-btn" data-category="kids" aria-pressed="false">Kids</button>
                <button class="filter-btn" data-category="shoes" aria-pressed="false">Shoes</button>
            </div>

            <div class="products-grid" id="productsGrid" role="region" aria-label="Product listings">
                <!-- Products injected by JS -->
            </div>
        </div>
    </main>

    <section class="seller-section" id="sell">
        <div class="container">
            <h2 style="font-size: 2.5rem; margin-bottom: 1rem;">Sell With Us</h2>
            <p style="color: var(--gray-300); max-width: 600px; margin: 0 auto 2rem;">
                Join verified sellers. We assist with photos, listings, and help coordinate delivery with trusted courier partners.
            </p>
            <div class="seller-benefits">
                <div class="benefit">
                    <span class="benefit-icon">üì∏</span>
                    <div>
                        <h4>Free Photography</h4>
                        <p style="color: var(--gray-300); font-size: 0.9rem;">We come to your stall</p>
                    </div>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">üöö</span>
                    <div>
                        <h4>Delivery Support</h4>
                        <p style="color: var(--gray-300); font-size: 0.9rem;">Wells Fargo/G4S coordination</p>
                    </div>
                </div>
                <div class="benefit">
                    <span class="benefit-icon">‚úÖ</span>
                    <div>
                        <h4>Free for Now</h4>
                        <p style="color: var(--gray-300); font-size: 0.9rem;">No commission during launch</p>
                    </div>
                </div>
            </div>
            
            <p style="font-size:0.8rem;color:var(--gray-300);margin-top:2rem;max-width:600px;margin-left:auto;margin-right:auto;">
                Verified sellers complete email verification and maintain consistent ratings.
            </p>
            
            <button class="hero-cta" style="background: var(--white); color: var(--primary); margin-top: 2rem; border: none; cursor: pointer;" onclick="openSellerModal()">
                Apply in 2 Minutes
            </button>
        </div>
    </section>

    <footer class="footer" role="contentinfo">
        <div class="footer-content">
            <div>
                <h3>üá∞üá™ Online Gikomba</h3>
                <p style="color: var(--gray-600); font-size: 0.9rem; margin-top: 1rem;">
                    Nairobi's trusted thrift marketplace. Verified sellers, authentic items, buyer-seller direct connection.
                </p>
            </div>
            <div>
                <h3>Support</h3>
                <ul>
                    <li><a href="https://wa.me/254736906440">WhatsApp Support</a></li>
                    <li><a href="#" onclick="showBuyerProtection()">Buyer Protection</a></li>
                    <li><a href="https://wa.me/254736906440?text=I%20want%20to%20report%20a%20seller">Report a Seller</a></li>
                    <li><a href="#" onclick="showDeliveryInfo()">Delivery Info</a></li>
                </ul>
            </div>
            <div>
                <h3>Sellers</h3>
                <ul>
                    <li><a href="#" onclick="openSellerModal()">Become Verified</a></li>
                    <li><a href="#" onclick="showSellerGuidelines()">Seller Guidelines</a></li>
                    <li><a href="#" onclick="showCommissionInfo()">Commission Rates</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-disclaimer">
            <p style="font-size:0.75rem;color:var(--gray-600);margin-bottom:1rem;">
                Online Gikomba does not hold payments or guarantee transactions. 
                Buyers are advised to confirm item details and delivery terms before sending payment.
            </p>
            <p style="font-size: 0.8rem; color: var(--gray-600);">
                ¬© <span id="copyrightYear">2024</span> Online Gikomba. All rights reserved.
            </p>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="Back to top">‚Üë</button>

    <!-- Product Detail Modal -->
    <div class="modal-overlay" id="productModal" role="dialog" aria-modal="true" aria-labelledby="productModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="productModalTitle">Product Details</h3>
                <button class="modal-close" onclick="closeModal('productModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="productModalBody">
                <!-- Product details injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('productModal')">Close</button>
                <button class="btn btn-primary" id="productModalAction">Order via WhatsApp</button>
            </div>
        </div>
    </div>

    <!-- Rating Modal -->
    <div class="modal-overlay" id="ratingModal" role="dialog" aria-modal="true" aria-labelledby="ratingModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="ratingModalTitle">Rate Your Experience</h3>
                <button class="modal-close" onclick="closeModal('ratingModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>How would you rate this item and the seller's service?</p>
                <div class="star-rating" id="starRating" role="radiogroup" aria-label="Rating">
                    <span class="star" data-rating="1" role="radio" aria-label="1 star" tabindex="0">‚òÖ</span>
                    <span class="star" data-rating="2" role="radio" aria-label="2 stars" tabindex="0">‚òÖ</span>
                    <span class="star" data-rating="3" role="radio" aria-label="3 stars" tabindex="0">‚òÖ</span>
                    <span class="star" data-rating="4" role="radio" aria-label="4 stars" tabindex="0">‚òÖ</span>
                    <span class="star" data-rating="5" role="radio" aria-label="5 stars" tabindex="0">‚òÖ</span>
                </div>
                <div class="form-group" style="margin-top: 1rem;">
                    <label for="ratingComment">Comment (optional)</label>
                    <textarea id="ratingComment" placeholder="Share your experience..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('ratingModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitRating()">Submit Rating</button>
            </div>
        </div>
    </div>

    <!-- Seller Registration Modal -->
    <div class="modal-overlay" id="sellerModal" role="dialog" aria-modal="true" aria-labelledby="sellerModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="sellerModalTitle">Become a Verified Seller</h3>
                <button class="modal-close" onclick="closeModal('sellerModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="sellerForm">
                    <div class="form-group">
                        <label for="sellerName">Business Name *</label>
                        <input type="text" id="sellerName" required placeholder="Your shop name">
                    </div>
                    <div class="form-group">
                        <label for="sellerEmail">Email Address *</label>
                        <input type="email" id="sellerEmail" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label for="sellerPhone">Phone Number (WhatsApp) *</label>
                        <input type="tel" id="sellerPhone" required placeholder="2547XX XXX XXX">
                    </div>
                    <div class="form-group">
                        <label for="sellerStall">Stall Location at Gikomba *</label>
                        <input type="text" id="sellerStall" required placeholder="e.g., Section A, Stall 45">
                    </div>
                    <div class="form-group">
                        <label for="sellerCategories">What do you sell? *</label>
                        <select id="sellerCategories" multiple required>
                            <option value="men">Men's Clothing</option>
                            <option value="women">Women's Clothing</option>
                            <option value="kids">Kids' Clothing</option>
                            <option value="shoes">Shoes</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--gray-600); margin-top: 1rem;">
                        By applying, you agree to our seller guidelines and verification process.
                    </p>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sellerModal')">Cancel</button>
                <button class="btn btn-primary" onclick="submitSellerApplication()">Apply Now</button>
            </div>
        </div>
    </div>

    <!-- Seller Profile Modal -->
    <div class="modal-overlay" id="sellerProfileModal" role="dialog" aria-modal="true" aria-labelledby="sellerProfileTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="sellerProfileTitle">Seller Profile</h3>
                <button class="modal-close" onclick="closeModal('sellerProfileModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="sellerProfileBody">
                <!-- Seller profile injected here -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('sellerProfileModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Notification Permission Modal -->
    <div class="modal-overlay" id="notificationModal" role="dialog" aria-modal="true" aria-labelledby="notificationModalTitle">
        <div class="modal">
            <div class="modal-header">
                <h3 id="notificationModalTitle">Get Notified</h3>
                <button class="modal-close" onclick="closeModal('notificationModal')" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Enter your email to get notified when <strong id="notificationSellerName"></strong> uploads new items.</p>
                <div class="form-group">
                    <label for="notificationEmail">Email Address</label>
                    <input type="email" id="notificationEmail" placeholder="your@email.com" required>
                </div>
                <input type="hidden" id="notificationSellerId">
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('notificationModal')">Cancel</button>
                <button class="btn btn-primary" onclick="subscribeToSeller()">Subscribe</button>
            </div>
        </div>
    </div>


    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        // Replace with your Firebase config after creating a project
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "gikomba-shop.firebaseapp.com",
            projectId: "gikomba-shop",
            storageBucket: "gikomba-shop.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase (commented out until config is set)
        // firebase.initializeApp(firebaseConfig);
        // const db = firebase.firestore();
        // const auth = firebase.auth();
        // const storage = firebase.storage();

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let products = [];
        let sellers = [];
        let currentFilter = 'all';
        let currentRating = 0;
        let currentRatingProduct = null;
        let subscribedSellers = JSON.parse(localStorage.getItem('subscribedSellers') || '[]');
        let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');

        // ============================================
        // SAMPLE DATA (Remove after Firebase setup)
        // ============================================
        const sampleProducts = [
            {
                id: 'GK001',
                title: 'Vintage Levi\'s Denim Jacket',
                size: 'L',
                price: 850,
                originalPrice: 1500,
                condition: 'excellent',
                conditionNote: '9/10 - Minimal fade',
                seller: 'Mama Kevo Stores',
                sellerId: 'seller1',
                sellerVerified: true,
                sellerSales: 47,
                sellerJoined: '2023',
                sellerRating: 4.5,
                sellerReviewCount: 23,
                category: 'men',
                views: 12,
                postedAt: new Date(Date.now() - 2 * 60 * 60 * 1000),
                expiresAt: new Date(Date.now() + 46 * 60 * 60 * 1000),
                stock: 1,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1523381210434-271e8be1f52b?w=400&h=400&fit=crop',
                rating: 4.2,
                ratingCount: 8,
                description: 'Authentic Levi\'s denim jacket in excellent condition. Minimal fading, no tears or stains.'
            },
            {
                id: 'GK002',
                title: 'Cotton Office Shirt - Blue',
                size: 'M',
                price: 450,
                originalPrice: 800,
                condition: 'good',
                conditionNote: '8/10 - Slight wrinkling',
                seller: 'Stylish Men Gikomba',
                sellerId: 'seller2',
                sellerVerified: true,
                sellerSales: 123,
                sellerJoined: '2022',
                sellerRating: 4.8,
                sellerReviewCount: 89,
                category: 'men',
                views: 8,
                postedAt: new Date(Date.now() - 5 * 60 * 60 * 1000),
                expiresAt: new Date(Date.now() + 43 * 60 * 60 * 1000),
                stock: 1,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400&h=400&fit=crop',
                rating: 4.5,
                ratingCount: 15,
                description: 'Classic blue office shirt, perfect for formal occasions. Good condition with slight wrinkling.'
            },
            {
                id: 'GK003',
                title: 'Ladies Trench Coat - Beige',
                size: 'UK 12',
                price: 1200,
                originalPrice: 2500,
                condition: 'excellent',
                conditionNote: '9.5/10 - Worn once',
                seller: 'Winter Wear Hub',
                sellerId: 'seller3',
                sellerVerified: true,
                sellerSales: 8,
                sellerJoined: '2024',
                sellerRating: 4.0,
                sellerReviewCount: 5,
                category: 'women',
                views: 23,
                postedAt: new Date(Date.now() - 1 * 60 * 60 * 1000),
                expiresAt: new Date(Date.now() + 47 * 60 * 60 * 1000),
                stock: 1,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1591047139829-d91aecb6caea?w=400&h=400&fit=crop',
                rating: 4.8,
                ratingCount: 3,
                description: 'Elegant beige trench coat, worn only once. Perfect for the rainy season.'
            },
            {
                id: 'GK004',
                title: 'Kids Hoodie Bundle (3pcs)',
                size: 'Ages 3-5',
                price: 600,
                originalPrice: 1200,
                condition: 'good',
                conditionNote: '8/10 - Mixed brands',
                seller: 'Tot\'s Corner',
                sellerId: 'seller4',
                sellerVerified: true,
                sellerSales: 89,
                sellerJoined: '2023',
                sellerRating: 4.7,
                sellerReviewCount: 56,
                category: 'kids',
                views: 15,
                postedAt: new Date(Date.now() - 3 * 60 * 60 * 1000),
                expiresAt: new Date(Date.now() + 45 * 60 * 60 * 1000),
                stock: 2,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?w=400&h=400&fit=crop',
                rating: 4.3,
                ratingCount: 12,
                description: 'Bundle of 3 kids hoodies in various colors. Mixed brands, all in good condition.'
            },
            {
                id: 'GK005',
                title: 'Nike Running Shoes',
                size: 'UK 9',
                price: 1500,
                originalPrice: 3500,
                condition: 'good',
                conditionNote: '7/10 - Some wear on soles',
                seller: 'Sneaker Spot',
                sellerId: 'seller5',
                sellerVerified: true,
                sellerSales: 34,
                sellerJoined: '2023',
                sellerRating: 4.4,
                sellerReviewCount: 18,
                category: 'shoes',
                views: 31,
                postedAt: new Date(Date.now() - 30 * 60 * 1000),
                expiresAt: new Date(Date.now() + 47.5 * 60 * 60 * 1000),
                stock: 1,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=400&fit=crop',
                rating: 4.1,
                ratingCount: 7,
                description: 'Authentic Nike running shoes. Some wear on soles but still in good condition.'
            },
            {
                id: 'GK006',
                title: 'Vintage Leather Jacket',
                size: 'XL',
                price: 2000,
                originalPrice: 4000,
                condition: 'excellent',
                conditionNote: '9/10 - Well maintained',
                seller: 'Mama Kevo Stores',
                sellerId: 'seller1',
                sellerVerified: true,
                sellerSales: 47,
                sellerJoined: '2023',
                sellerRating: 4.5,
                sellerReviewCount: 23,
                category: 'men',
                views: 18,
                postedAt: new Date(Date.now() - 6 * 60 * 60 * 1000),
                expiresAt: new Date(Date.now() + 42 * 60 * 60 * 1000),
                stock: 1,
                status: 'available',
                image: 'https://images.unsplash.com/photo-1551028719-00167b16eac5?w=400&h=400&fit=crop',
                rating: 4.6,
                ratingCount: 10,
                description: 'Classic vintage leather jacket. Well maintained, excellent condition.'
            }
        ];

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            // Set dynamic copyright year
            document.getElementById('copyrightYear').textContent = new Date().getFullYear();
            
            // Load products (from Firebase or sample data)
            loadProducts();
            
            // Setup event listeners
            setupEventListeners();
            
            // Setup back to top button
            setupBackToTop();
            
            // Track page view
            gtag('event', 'page_view', {
                page_title: document.title,
                page_location: window.location.href
            });
        });

        // ============================================
        // PRODUCT LOADING & RENDERING
        // ============================================
        async function loadProducts() {
            showLoading();
            
            // TODO: Replace with Firebase fetch
            // const snapshot = await db.collection('products').get();
            // products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            // Using sample data for now
            products = [...sampleProducts];
            
            renderProducts();
            hideLoading();
        }

        function renderProducts(productsToRender = products) {
            const grid = document.getElementById('productsGrid');
            
            if (productsToRender.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <p style="font-size: 1.25rem; color: var(--gray-600);">No products found matching your criteria.</p>
                        <button class="btn btn-primary" onclick="clearFilters()" style="margin-top: 1rem;">Clear Filters</button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = productsToRender.map(product => createProductCard(product)).join('');
        }

        function createProductCard(product) {
            const isReserved = wishlist.includes(product.id);
            const isSubscribed = subscribedSellers.includes(product.sellerId);
            const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
            const timeLeft = getTimeLeft(product.expiresAt);
            const postedTime = getTimeAgo(product.postedAt);
            
            return `
                <article class="product-card ${isReserved ? 'reserved' : ''}" data-product-id="${product.id}">
                    <div class="product-badges">
                        ${isReserved ? '<span class="badge badge-reserved">‚ù§Ô∏è Saved</span>' : ''}
                        ${product.condition === 'excellent' ? '<span class="badge badge-grade">Grade A</span>' : ''}
                        ${isNewProduct(product.postedAt) ? '<span class="badge badge-new">Just Added</span>' : ''}
                        ${product.sellerVerified && product.sellerSales > 50 ? '<span class="badge badge-verified">Top Seller</span>' : ''}
                    </div>
                    <div class="view-counter" aria-label="${product.views} people viewing">
                        üëÅ ${product.views} viewing
                    </div>
                    <div class="product-image-container">
                        <img src="${product.image}" alt="${product.title} - ${product.size}" loading="lazy" onclick="openProductModal('${product.id}')">
                    </div>
                    <div class="product-info">
                        <div class="seller-row">
                            <span class="seller-name" onclick="openSellerProfile('${product.sellerId}')">${product.seller}</span>
                            ${product.sellerVerified ? 
                                `<span class="seller-badge verified" title="ID & stall verified at Gikomba market">‚úì Verified</span>` : 
                                `<span class="seller-badge">New Seller</span>`}
                            <span class="seller-stats">${product.sellerSales} sales</span>
                        </div>
                        <h3 class="product-title">${product.title} (${product.size})</h3>
                        <div class="product-meta">
                            <span class="condition">
                                <span class="condition-dot condition-${product.condition}"></span>
                                ${product.conditionNote}
                            </span>
                        </div>
                        <div class="rating-row">
                            <span class="stars">${renderStars(product.rating)}</span>
                            <span class="rating-count">(${product.ratingCount} reviews)</span>
                        </div>
                        <div class="price-row">
                            <span class="product-price">KES ${product.price.toLocaleString()}</span>
                            <span class="original-price">KES ${product.originalPrice.toLocaleString()}</span>
                            <span class="discount">-${discount}%</span>
                        </div>
                        <div class="stock-info">
                            <span>‚è± ${postedTime}</span>
                            <span class="time-left">‚è≥ ${timeLeft}</span>
                        </div>
                        <button class="whatsapp-btn" onclick="handleOrder('${product.id}')">
                            üì± Order via WhatsApp
                        </button>
                        <button class="notify-btn ${isSubscribed ? 'subscribed' : ''}" onclick="toggleSellerNotification('${product.sellerId}', '${product.seller}')">
                            ${isSubscribed ? '‚úì Subscribed' : 'üîî Get Notified'}
                        </button>
                        <div class="protection-notice">
                            <span>üõ°Ô∏è</span>
                            <span>Don't pay until seller confirms item is available</span>
                        </div>
                    </div>
                </article>
            `;
        }

        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '‚òÖ';
            }
            if (hasHalfStar) {
                stars += '¬Ω';
            }
            for (let i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++) {
                stars += '‚òÜ';
            }
            
            return stars;
        }

        function getTimeLeft(expiresAt) {
            const now = new Date();
            const diff = expiresAt - now;
            
            if (diff <= 0) return 'Expired';
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            if (hours < 1) {
                const minutes = Math.floor(diff / (1000 * 60));
                return `${minutes}m left`;
            }
            return `${hours}h left`;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (hours < 1) {
                const minutes = Math.floor(diff / (1000 * 60));
                return `${minutes}m ago`;
            }
            return `${hours}h ago`;
        }

        function isNewProduct(postedAt) {
            const diff = new Date() - postedAt;
            return diff < (3 * 60 * 60 * 1000); // Less than 3 hours
        }

        function showLoading() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = Array(4).fill('<div class="skeleton skeleton-card"></div>').join('');
        }

        function hideLoading() {
            // Loading is replaced by renderProducts
        }

        // ============================================
        // FILTERING & SEARCH
        // ============================================
        function setupEventListeners() {
            // Category filters
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('active');
                        b.setAttribute('aria-pressed', 'false');
                    });
                    e.target.classList.add('active');
                    e.target.setAttribute('aria-pressed', 'true');
                    currentFilter = e.target.dataset.category;
                    applyFilters();
                });
            });

            // Search input
            document.getElementById('searchInput').addEventListener('input', debounce(() => {
                applyFilters();
            }, 300));

            // Price range
            document.getElementById('minPrice').addEventListener('input', debounce(() => {
                applyFilters();
            }, 300));
            document.getElementById('maxPrice').addEventListener('input', debounce(() => {
                applyFilters();
            }, 300));

            // Sort
            document.getElementById('sortSelect').addEventListener('change', () => {
                applyFilters();
            });

            // Star rating in modal
            document.querySelectorAll('#starRating .star').forEach(star => {
                star.addEventListener('click', () => {
                    currentRating = parseInt(star.dataset.rating);
                    updateStarDisplay(currentRating);
                });
                star.addEventListener('mouseenter', () => {
                    updateStarDisplay(parseInt(star.dataset.rating));
                });
            });
            document.getElementById('starRating').addEventListener('mouseleave', () => {
                updateStarDisplay(currentRating);
            });
        }

        function applyFilters() {
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            const minPrice = parseInt(document.getElementById('minPrice').value) || 0;
            const maxPrice = parseInt(document.getElementById('maxPrice').value) || Infinity;
            const sortBy = document.getElementById('sortSelect').value;

            let filtered = products.filter(product => {
                // Category filter
                if (currentFilter !== 'all' && product.category !== currentFilter) {
                    return false;
                }

                // Search filter
                if (searchQuery && !(
                    product.title.toLowerCase().includes(searchQuery) ||
                    product.seller.toLowerCase().includes(searchQuery) ||
                    product.category.toLowerCase().includes(searchQuery)
                )) {
                    return false;
                }

                // Price filter
                if (product.price < minPrice || product.price > maxPrice) {
                    return false;
                }

                return true;
            });

            // Sort
            filtered.sort((a, b) => {
                switch(sortBy) {
                    case 'price-low': return a.price - b.price;
                    case 'price-high': return b.price - a.price;
                    case 'popular': return b.views - a.views;
                    case 'rated': return b.rating - a.rating;
                    case 'newest': default: return b.postedAt - a.postedAt;
                }
            });

            renderProducts(filtered);

            // Track filter usage
            gtag('event', 'filter_applied', {
                category: currentFilter,
                search: searchQuery,
                min_price: minPrice,
                max_price: maxPrice,
                sort: sortBy
            });
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('minPrice').value = '';
            document.getElementById('maxPrice').value = '';
            document.getElementById('sortSelect').value = 'newest';
            
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-pressed', 'false');
            });
            document.querySelector('[data-category="all"]').classList.add('active');
            document.querySelector('[data-category="all"]').setAttribute('aria-pressed', 'true');
            
            currentFilter = 'all';
            renderProducts(products);
            
            showToast('Filters cleared', 'info');
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ============================================
        // ORDER & WHATSAPP INTEGRATION
        // ============================================
        function handleOrder(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            // Add to wishlist (local reservation)
            if (!wishlist.includes(productId)) {
                wishlist.push(productId);
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
            }

            // Increment view count (Firebase)
            incrementProductViews(productId);

            // Create WhatsApp message
            const message = `Hi, I'm interested in buying:

*Item:* ${product.title}
*ID:* ${product.id}
*Price:* KES ${product.price.toLocaleString()}
*Size:* ${product.size}
*Seller:* ${product.seller}

Is this still available? Please confirm before I send payment.`;

            const encodedMessage = encodeURIComponent(message);
            window.open(`https://wa.me/254736906440?text=${encodedMessage}`, '_blank');

            // Track conversion
            gtag('event', 'begin_checkout', {
                items: [{
                    item_id: product.id,
                    item_name: product.title,
                    price: product.price,
                    quantity: 1
                }]
            });

            showToast('Opening WhatsApp...', 'success');
        }

        async function incrementProductViews(productId) {
            // TODO: Update Firebase
            // await db.collection('products').doc(productId).update({
            //     views: firebase.firestore.FieldValue.increment(1)
            // });
            
            // Update local
            const product = products.find(p => p.id === productId);
            if (product) {
                product.views++;
            }
        }

        // ============================================
        // RATING SYSTEM
        // ============================================
        function openRatingModal(productId) {
            currentRatingProduct = productId;
            currentRating = 0;
            updateStarDisplay(0);
            document.getElementById('ratingComment').value = '';
            openModal('ratingModal');
        }

        function updateStarDisplay(rating) {
            document.querySelectorAll('#starRating .star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        async function submitRating() {
            if (currentRating === 0) {
                showToast('Please select a rating', 'error');
                return;
            }

            const comment = document.getElementById('ratingComment').value;
            
            // TODO: Save to Firebase
            // await db.collection('ratings').add({
            //     productId: currentRatingProduct,
            //     rating: currentRating,
            //     comment: comment,
            //     createdAt: firebase.firestore.FieldValue.serverTimestamp()
            // });

            showToast('Thank you for your rating!', 'success');
            closeModal('ratingModal');

            // Track rating
            gtag('event', 'submit_rating', {
                product_id: currentRatingProduct,
                rating: currentRating
            });
        }

        // ============================================
        // SELLER NOTIFICATIONS
        // ============================================
        function toggleSellerNotification(sellerId, sellerName) {
            if (subscribedSellers.includes(sellerId)) {
                // Already subscribed - show message
                showToast(`You're already subscribed to ${sellerName}`, 'info');
            } else {
                // Show subscription modal
                document.getElementById('notificationSellerId').value = sellerId;
                document.getElementById('notificationSellerName').textContent = sellerName;
                openModal('notificationModal');
            }
        }

        async function subscribeToSeller() {
            const sellerId = document.getElementById('notificationSellerId').value;
            const email = document.getElementById('notificationEmail').value;
            
            if (!email || !email.includes('@')) {
                showToast('Please enter a valid email', 'error');
                return;
            }

            // TODO: Save to Firebase
            // await db.collection('subscriptions').add({
            //     sellerId: sellerId,
            //     email: email,
            //     subscribedAt: firebase.firestore.FieldValue.serverTimestamp()
            // });

            subscribedSellers.push(sellerId);
            localStorage.setItem('subscribedSellers', JSON.stringify(subscribedSellers));

            showToast('Subscribed successfully! You\'ll be notified of new items.', 'success');
            closeModal('notificationModal');
            applyFilters(); // Re-render to update button state

            // Track subscription
            gtag('event', 'subscribe_seller', {
                seller_id: sellerId
            });
        }

        // ============================================
        // SELLER REGISTRATION
        // ============================================
        function openSellerModal() {
            openModal('sellerModal');
        }

        async function submitSellerApplication() {
            const form = document.getElementById('sellerForm');
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const sellerData = {
                name: document.getElementById('sellerName').value,
                email: document.getElementById('sellerEmail').value,
                phone: document.getElementById('sellerPhone').value,
                stallLocation: document.getElementById('sellerStall').value,
                categories: Array.from(document.getElementById('sellerCategories').selectedOptions).map(o => o.value),
                status: 'pending',
                createdAt: new Date(),
                verified: false,
                sales: 0,
                rating: 0,
                reviewCount: 0
            };

            // TODO: Save to Firebase and send verification email
            // await db.collection('sellers').add(sellerData);
            // await sendVerificationEmail(sellerData.email);

            showToast('Application submitted! Check your email for verification.', 'success');
            closeModal('sellerModal');
            form.reset();

            // Track seller signup
            gtag('event', 'seller_signup', {
                categories: sellerData.categories.join(',')
            });
        }

        // ============================================
        // SELLER PROFILE
        // ============================================
        function openSellerProfile(sellerId) {
            const sellerProducts = products.filter(p => p.sellerId === sellerId);
            if (sellerProducts.length === 0) return;
            
            const seller = sellerProducts[0];
            
            document.getElementById('sellerProfileBody').innerHTML = `
                <div class="seller-profile-header">
                    <div class="seller-avatar">${seller.seller.charAt(0)}</div>
                    <div class="seller-profile-info">
                        <h4>${seller.seller}</h4>
                        <div class="stars">${renderStars(seller.sellerRating)}</div>
                        <span style="font-size: 0.85rem; color: var(--gray-600);">${seller.sellerReviewCount} reviews</span>
                        ${seller.sellerVerified ? '<span class="badge badge-verified" style="margin-top: 0.5rem;">‚úì Verified Seller</span>' : ''}
                    </div>
                </div>
                <div class="seller-profile-stats">
                    <div class="stat">
                        <div class="stat-value">${seller.sellerSales}</div>
                        <div class="stat-label">Sales</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${sellerProducts.length}</div>
                        <div class="stat-label">Active Items</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${seller.sellerJoined}</div>
                        <div class="stat-label">Member Since</div>
                    </div>
                </div>
                <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Items from this seller</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 1rem;">
                    ${sellerProducts.map(p => `
                        <div style="cursor: pointer;" onclick="closeModal('sellerProfileModal'); openProductModal('${p.id}')">
                            <img src="${p.image}" style="width: 100%; height: 120px; object-fit: cover; border-radius: 8px;">
                            <p style="font-size: 0.8rem; margin-top: 0.5rem;">KES ${p.price.toLocaleString()}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            
            openModal('sellerProfileModal');
        }

        // ============================================
        // PRODUCT MODAL
        // ============================================
        function openProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('productModalTitle').textContent = product.title;
            document.getElementById('productModalBody').innerHTML = `
                <img src="${product.image}" style="width: 100%; border-radius: 8px; margin-bottom: 1rem;">
                <p>${product.description}</p>
                <div style="margin-top: 1rem;">
                    <p><strong>Size:</strong> ${product.size}</p>
                    <p><strong>Condition:</strong> ${product.conditionNote}</p>
                    <p><strong>Seller:</strong> ${product.seller} ${product.sellerVerified ? '‚úì' : ''}</p>
                </div>
                <div class="price-row" style="margin-top: 1rem;">
                    <span class="product-price">KES ${product.price.toLocaleString()}</span>
                    <span class="original-price">KES ${product.originalPrice.toLocaleString()}</span>
                </div>
                <div class="rating-row">
                    <span class="stars">${renderStars(product.rating)}</span>
                    <span class="rating-count">(${product.ratingCount} reviews)</span>
                </div>
                <button class="btn btn-secondary" onclick="openRatingModal('${product.id}')" style="margin-top: 1rem;">
                    Rate this item
                </button>
            `;
            
            document.getElementById('productModalAction').onclick = () => {
                closeModal('productModal');
                handleOrder(productId);
            };
            
            openModal('productModal');

            // Track product view
            gtag('event', 'view_item', {
                items: [{
                    item_id: product.id,
                    item_name: product.title,
                    price: product.price
                }]
            });
        }

        // ============================================
        // MODAL UTILITIES
        // ============================================
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                }
            });
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.body.style.overflow = '';
            }
        });

        // ============================================
        // TOAST NOTIFICATIONS
        // ============================================
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '‚úì',
                error: '‚úó',
                warning: '‚ö†',
                info: '‚Ñπ'
            };
            
            toast.innerHTML = `
                <span>${icons[type]}</span>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // ============================================
        // MOBILE MENU
        // ============================================
        function toggleMenu() {
            document.getElementById('mobileNav').classList.toggle('active');
        }

        // ============================================
        // BACK TO TOP
        // ============================================
        function setupBackToTop() {
            const btn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 500) {
                    btn.classList.add('visible');
                } else {
                    btn.classList.remove('visible');
                }
            });
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ============================================
        // INFO MODALS
        // ============================================
        function showBuyerProtection() {
            showToast('Pay only after confirming item availability. Report issues within 24 hours via WhatsApp.', 'info');
        }

        function showDeliveryInfo() {
            showToast('Nairobi same-day delivery. Countrywide 1-3 days via Wells Fargo or G4S.', 'info');
        }

        function showSellerGuidelines() {
            showToast('Sellers must complete email verification and maintain consistent ratings.', 'info');
        }

        function showCommissionInfo() {
            showToast('Currently FREE for all sellers during launch period!', 'success');
        }

        // ============================================
        // REAL-TIME UPDATES (Simulated)
        // ============================================
        setInterval(() => {
            // Simulate view count changes
            products.forEach(p => {
                if (Math.random() > 0.7) {
                    p.views += Math.floor(Math.random() * 3) - 1;
                    if (p.views < 1) p.views = 1;
                }
            });
            
            // Update view counters without full re-render
            document.querySelectorAll('.view-counter').forEach((counter, index) => {
                if (products[index]) {
                    counter.innerHTML = `üëÅ ${products[index].views} viewing`;
                }
            });
        }, 10000);

        // Update time left every minute
        setInterval(() => {
            document.querySelectorAll('.stock-info').forEach((info, index) => {
                if (products[index]) {
                    const timeLeft = getTimeLeft(products[index].expiresAt);
                    const postedTime = getTimeAgo(products[index].postedAt);
                    info.innerHTML = `
                        <span>‚è± ${postedTime}</span>
                        <span class="time-left">‚è≥ ${timeLeft}</span>
                    `;
                }
            });
        }, 60000);

    </script>
</body>
</html>